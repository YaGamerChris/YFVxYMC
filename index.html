<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ya! FM Villahermosa - Radio en Vivo</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet" />
  <link rel="icon" href="YFV.ico" />
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(135deg, #8B0000, #FF0000);
      color: white;
      font-family: 'Playfair Display', serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    p {
      font-size: 1.2em;
      margin-bottom: 30px;
    }

    audio {
      width: 80%;
      max-width: 600px;
      outline: none;
      transition: opacity 0.3s;
    }

    .info {
      font-size: 0.9em;
      margin-top: 20px;
      color: #e0e0e0;
    }

    .aviso {
      margin-top: 10px;
      font-size: 1.2em;
      color: #ffd700;
      font-weight: bold;
      display: none;
    }

    #logo {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 120px;
      height: auto;
      z-index: 1000;
      user-select: none;
      pointer-events: none;
    }

    /* Contenedor para el mensaje de incompatibilidad */
    #incompatibleMessage {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #222;
      color: #fff;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      font-size: 1.2em;
      z-index: 9999;
    }

    #incompatibleMessage a {
      color: #03d4a8;
      text-decoration: none;
      margin: 0 5px;
      font-weight: bold;
    }
    #incompatibleMessage a:hover {
      text-decoration: underline;
    }

    /* Footer fijo abajo a la derecha */
    footer {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 0.9em;
      color: white;
      opacity: 0.7;
      user-select: none;
    }
  </style>
</head>
<body>
  <!-- Mensaje para navegadores incompatibles -->
  <div id="incompatibleMessage">
    <h2>Navegador no compatible</h2>
    <p>Para una mejor experiencia, te recomendamos descargar y usar <strong>Google Chrome</strong> en cualquiera de estas plataformas:</p>
    <p>
      <a href="https://www.google.com/chrome/" target="_blank" rel="noopener noreferrer">Windows</a> |
      <a href="https://www.google.com/chrome/" target="_blank" rel="noopener noreferrer">Mac</a> |
      <a href="https://play.google.com/store/apps/details?id=com.android.chrome" target="_blank" rel="noopener noreferrer">Android</a> |
      <a href="https://apps.apple.com/app/google-chrome/id535886823" target="_blank" rel="noopener noreferrer">iOS</a> |
      <a href="https://www.google.com/chrome/" target="_blank" rel="noopener noreferrer">Linux</a>
    </p>
  </div>

  <!-- Logo -->
  <img src="YMC x YFV.png" alt="Logo YMC x YFV" id="logo" />

  <div id="contenidoPrincipal">
    <h1>Ya! FM Villahermosa</h1>
    <p>Estás sintonizando Ya! FM Villahermosa 95.7</p>

    <!-- Radio 24/7 -->
    <audio id="radio" controls>
      <source src="https://sg.centrocibernetico.com/yafmvillahermosa" type="audio/mpeg">
      Tu navegador no soporta el servidor de radio 95.7 FM.
    </audio>

    <!-- Mezcla especial -->
    <audio id="mezcla" src="mezcla.mp3" preload="auto"></audio>

    <!-- Contador regresivo durante mezcla -->
    <div id="avisoMezcla" class="aviso"></div>

    <div class="info">Transmisión 24/7</div>
  </div>

  <footer>Powered by Ya! FM Villahermosa</footer>

  <script>
    // Detecta Internet Explorer
    function esIE() {
      return /MSIE|Trident/.test(window.navigator.userAgent);
    }

    if (esIE()) {
      // Mostrar mensaje incompatibilidad y ocultar contenido
      document.getElementById('incompatibleMessage').style.display = 'flex';
      document.getElementById('contenidoPrincipal').style.display = 'none';
      document.getElementById('logo').style.display = 'none';
    } else {
      // Si no es IE, carga todo normalmente

      const DURACION_MEZCLA = 3301 * 1000; // 55 min 1 seg
      const radio = document.getElementById('radio');
      const mezcla = document.getElementById('mezcla');
      const aviso = document.getElementById('avisoMezcla');

      function msATiempo(ms) {
        const totalSegundos = Math.floor(ms / 1000);
        const minutos = Math.floor(totalSegundos / 60);
        const segundos = totalSegundos % 60;
        return `${minutos.toString().padStart(2,'0')}:${segundos.toString().padStart(2,'0')}`;
      }

      function iniciarMezcla(offset = 0) {
        radio.pause();
        radio.controls = false;
        radio.style.pointerEvents = "none";
        radio.style.opacity = "0.5";
        aviso.style.display = "block";

        mezcla.currentTime = offset;
        mezcla.play().catch(err => {
          console.log("Ups, Se desconecto del servidor de radio", err);
        });
      }

      let intervaloContador = null;
      function actualizarContador(inicio) {
        if (intervaloContador) clearInterval(intervaloContador);
        intervaloContador = setInterval(() => {
          const ahora = Date.now();
          const tiempoPasado = ahora - inicio;
          const tiempoRestante = DURACION_MEZCLA - tiempoPasado;

          if (tiempoRestante <= 0) {
            aviso.style.display = "none";
            aviso.textContent = "";
            clearInterval(intervaloContador);
            return;
          }

          aviso.style.display = "block";
          aviso.textContent = `Volvemos en: ${msATiempo(tiempoRestante)}`;
        }, 1000);
      }

      function prepararReproduccion() {
        const mezclaInicioGuardado = localStorage.getItem('mezclaInicio');
        if (mezclaInicioGuardado) {
          const tiempoPasado = Date.now() - parseInt(mezclaInicioGuardado);
          if (tiempoPasado < DURACION_MEZCLA) {
            const offsetSegundos = Math.floor(tiempoPasado / 1000);
            iniciarMezcla(offsetSegundos);
            actualizarContador(parseInt(mezclaInicioGuardado));
            return true;
          } else {
            localStorage.removeItem('mezclaInicio');
          }
        }
        radio.play().catch(() => {});
        return false;
      }

      let mezclaYaReproducida = false;

      window.addEventListener('load', () => {
        mezclaYaReproducida = prepararReproduccion();
      });

      setInterval(() => {
        const now = new Date();
        if (now.getHours() === 17 && now.getMinutes() === 43 && !mezclaYaReproducida) {
          mezclaYaReproducida = true;
          const inicio = Date.now();
          localStorage.setItem('mezclaInicio', inicio.toString());
          iniciarMezcla(0);
          actualizarContador(inicio);
        }
      }, 1000);

      mezcla.addEventListener('ended', () => {
        console.log("Retomando radio. Espere un momento...");
        localStorage.removeItem('mezclaInicio');

        radio.play().catch(() => {
          console.log("No se pudo reanudar la radio, recarga la página o inténtalo más tarde.");
        });

        radio.controls = true;
        radio.style.pointerEvents = "auto";
        radio.style.opacity = "1";
        aviso.style.display = "none";
        aviso.textContent = "";
        mezclaYaReproducida = false;
      });

      document.body.addEventListener('click', () => {
        const mezclaInicioGuardado = localStorage.getItem('mezclaInicio');
        if (mezclaInicioGuardado) {
          mezcla.play().catch(() => {
            console.log("No se pudo reproducir mezcla tras click.");
          });
        } else {
          radio.play().catch(() => {
            console.log("No se pudo reproducir radio tras click.");
          });
        }
      });
    }
  </script>
</body>
</html>

